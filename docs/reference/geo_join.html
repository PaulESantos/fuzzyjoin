<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Join two tables based on a geo distance of longitudes and latitudes — geo_join • fuzzyjoin</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Join two tables based on a geo distance of longitudes and latitudes — geo_join" />
<meta property="og:description" content="This allows joining based on combinations of longitudes and latitudes. If
you are using a distance metric that is *not* based on latitude and
longitude, use distance_join instead. Distances are
calculated based on the distHaversine, distGeo,
distCosine, etc methods in the geosphere package." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fuzzyjoin</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.6</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/stringdist_join.html">Example of `stringdist_inner_join`: Correcting misspellings against a dictionary</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/dgrtwo/fuzzyjoin/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Join two tables based on a geo distance of longitudes and latitudes</h1>
    <small class="dont-index">Source: <a href='https://github.com/dgrtwo/fuzzyjoin/blob/master/R/geo_join.R'><code>R/geo_join.R</code></a></small>
    <div class="hidden name"><code>geo_join.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This allows joining based on combinations of longitudes and latitudes. If
you are using a distance metric that is *not* based on latitude and
longitude, use <code><a href='distance_join.html'>distance_join</a></code> instead. Distances are
calculated based on the <code>distHaversine</code>, <code>distGeo</code>,
<code>distCosine</code>, etc methods in the geosphere package.</p>
    </div>

    <pre class="usage"><span class='fu'>geo_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>max_dist</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"haversine"</span>, <span class='st'>"geo"</span>, <span class='st'>"cosine"</span>, <span class='st'>"meeus"</span>, <span class='st'>"vincentysphere"</span>,
    <span class='st'>"vincentyellipsoid"</span>),
  <span class='kw'>unit</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"miles"</span>, <span class='st'>"km"</span>),
  <span class='kw'>mode</span> <span class='kw'>=</span> <span class='st'>"inner"</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>geo_inner_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"haversine"</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>geo_left_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"haversine"</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>geo_right_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"haversine"</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>geo_full_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"haversine"</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>geo_semi_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"haversine"</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)

<span class='fu'>geo_anti_join</span>(
  <span class='no'>x</span>,
  <span class='no'>y</span>,
  <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"haversine"</span>,
  <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='no'>...</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>A tbl</p></td>
    </tr>
    <tr>
      <th>y</th>
      <td><p>A tbl</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>Columns by which to join the two tables</p></td>
    </tr>
    <tr>
      <th>max_dist</th>
      <td><p>Maximum distance to use for joining</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>Method to use for computing distance: one of
"haversine" (default), "geo", "cosine", "meeus", "vincentysphere",
"vincentyellipsoid"</p></td>
    </tr>
    <tr>
      <th>unit</th>
      <td><p>Unit of distance for threshold (default "miles")</p></td>
    </tr>
    <tr>
      <th>mode</th>
      <td><p>One of "inner", "left", "right", "full" "semi", or "anti"</p></td>
    </tr>
    <tr>
      <th>distance_col</th>
      <td><p>If given, will add a column with this
name containing the geographical distance between the two</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Extra arguments passed on to the distance method</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>"Haversine" was chosen as default since in some tests it is
approximately the fastest method. Note that by far the slowest method is
vincentyellipsoid, and on fuzzy joins should only be used when there are
very few pairs and accuracy is imperative.</p>
<p>If you need to use a custom geo method, you may want to write it directly
with the <code>multi_by</code> and <code>multi_match_fun</code> arguments to
<code>fuzzy_join</code>.</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>dplyr</span>)
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"state"</span>)

<span class='co'># find pairs of US states whose centers are within</span>
<span class='co'># 200 miles of each other</span>
<span class='no'>states</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/reexports.html'>data_frame</a></span>(<span class='kw'>state</span> <span class='kw'>=</span> <span class='no'>state.name</span>,
                     <span class='kw'>longitude</span> <span class='kw'>=</span> <span class='no'>state.center</span>$<span class='no'>x</span>,
                     <span class='kw'>latitude</span> <span class='kw'>=</span> <span class='no'>state.center</span>$<span class='no'>y</span>)

<span class='no'>s1</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span>(<span class='no'>states</span>, <span class='kw'>state1</span> <span class='kw'>=</span> <span class='no'>state</span>)
<span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/rename.html'>rename</a></span>(<span class='no'>states</span>, <span class='kw'>state2</span> <span class='kw'>=</span> <span class='no'>state</span>)

<span class='no'>pairs</span> <span class='kw'>&lt;-</span> <span class='no'>s1</span> <span class='kw'>%&gt;%</span>
 <span class='fu'>geo_inner_join</span>(<span class='no'>s2</span>, <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>200</span>) <span class='kw'>%&gt;%</span>
 <span class='fu'><a href='https://dplyr.tidyverse.org/reference/filter.html'>filter</a></span>(<span class='no'>state1</span> <span class='kw'>!=</span> <span class='no'>state2</span>)</div><div class='output co'>#&gt; <span class='message'>Joining by: c("longitude", "latitude")</span></div><div class='input'>
<span class='no'>pairs</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 74 x 6</span><span>
#&gt;    state1      longitude.x latitude.x state2        longitude.y latitude.y
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>               </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> Alabama           -</span><span style='color: #BB0000;'>86.8</span><span>       32.6 Georgia             -</span><span style='color: #BB0000;'>83.4</span><span>       32.3
#&gt; </span><span style='color: #555555;'> 2</span><span> Alabama           -</span><span style='color: #BB0000;'>86.8</span><span>       32.6 Mississippi         -</span><span style='color: #BB0000;'>89.8</span><span>       32.7
#&gt; </span><span style='color: #555555;'> 3</span><span> Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 Massachusetts       -</span><span style='color: #BB0000;'>71.6</span><span>       42.4
#&gt; </span><span style='color: #555555;'> 4</span><span> Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 New Hampshire       -</span><span style='color: #BB0000;'>71.4</span><span>       43.4
#&gt; </span><span style='color: #555555;'> 5</span><span> Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 New Jersey          -</span><span style='color: #BB0000;'>74.2</span><span>       40.0
#&gt; </span><span style='color: #555555;'> 6</span><span> Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 New York            -</span><span style='color: #BB0000;'>75.1</span><span>       43.1
#&gt; </span><span style='color: #555555;'> 7</span><span> Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 Rhode Island        -</span><span style='color: #BB0000;'>71.1</span><span>       41.6
#&gt; </span><span style='color: #555555;'> 8</span><span> Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 Vermont             -</span><span style='color: #BB0000;'>72.5</span><span>       44.3
#&gt; </span><span style='color: #555555;'> 9</span><span> Delaware          -</span><span style='color: #BB0000;'>75.0</span><span>       38.7 Maryland            -</span><span style='color: #BB0000;'>76.6</span><span>       39.3
#&gt; </span><span style='color: #555555;'>10</span><span> Delaware          -</span><span style='color: #BB0000;'>75.0</span><span>       38.7 New Jersey          -</span><span style='color: #BB0000;'>74.2</span><span>       40.0
#&gt; </span><span style='color: #555555;'># … with 64 more rows</span><span></div><div class='input'>
<span class='co'># plot them</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='no'>ggplot2</span>)
<span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggplot.html'>ggplot</a></span>(<span class='no'>pairs</span>, <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/aes.html'>aes</a></span>(<span class='kw'>x</span> <span class='kw'>=</span> <span class='no'>longitude.x</span>, <span class='kw'>y</span> <span class='kw'>=</span> <span class='no'>latitude.x</span>,
                  <span class='kw'>xend</span> <span class='kw'>=</span> <span class='no'>longitude.y</span>, <span class='kw'>yend</span> <span class='kw'>=</span> <span class='no'>latitude.y</span>)) +
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/geom_segment.html'>geom_segment</a></span>(<span class='kw'>color</span> <span class='kw'>=</span> <span class='st'>"red"</span>) +
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/borders.html'>borders</a></span>(<span class='st'>"state"</span>) +
  <span class='fu'><a href='https://ggplot2.tidyverse.org/reference/ggtheme.html'>theme_void</a></span>()</div><div class='img'><img src='geo_join-1.png' alt='' width='700' height='433' /></div><div class='input'>
<span class='co'># also get distances</span>
<span class='no'>s1</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>geo_inner_join</span>(<span class='no'>s2</span>, <span class='kw'>max_dist</span> <span class='kw'>=</span> <span class='fl'>200</span>, <span class='kw'>distance_col</span> <span class='kw'>=</span> <span class='st'>"distance"</span>)</div><div class='output co'>#&gt; <span class='message'>Joining by: c("longitude", "latitude")</span></div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 124 x 7</span><span>
#&gt;    state1     longitude.x latitude.x state2      longitude.y latitude.y distance
#&gt;    </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>            </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>             </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>      </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>    </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'> 1</span><span> Alabama          -</span><span style='color: #BB0000;'>86.8</span><span>       32.6 Alabama           -</span><span style='color: #BB0000;'>86.8</span><span>       32.6      0  
#&gt; </span><span style='color: #555555;'> 2</span><span> Alabama          -</span><span style='color: #BB0000;'>86.8</span><span>       32.6 Georgia           -</span><span style='color: #BB0000;'>83.4</span><span>       32.3    198. 
#&gt; </span><span style='color: #555555;'> 3</span><span> Alabama          -</span><span style='color: #BB0000;'>86.8</span><span>       32.6 Mississippi       -</span><span style='color: #BB0000;'>89.8</span><span>       32.7    178. 
#&gt; </span><span style='color: #555555;'> 4</span><span> Alaska          -</span><span style='color: #BB0000;'>127.</span><span>        49.2 Alaska           -</span><span style='color: #BB0000;'>127.</span><span>        49.2      0  
#&gt; </span><span style='color: #555555;'> 5</span><span> Arizona         -</span><span style='color: #BB0000;'>112.</span><span>        34.2 Arizona          -</span><span style='color: #BB0000;'>112.</span><span>        34.2      0  
#&gt; </span><span style='color: #555555;'> 6</span><span> Arkansas         -</span><span style='color: #BB0000;'>92.3</span><span>       34.7 Arkansas          -</span><span style='color: #BB0000;'>92.3</span><span>       34.7      0  
#&gt; </span><span style='color: #555555;'> 7</span><span> California      -</span><span style='color: #BB0000;'>120.</span><span>        36.5 California       -</span><span style='color: #BB0000;'>120.</span><span>        36.5      0  
#&gt; </span><span style='color: #555555;'> 8</span><span> Colorado        -</span><span style='color: #BB0000;'>106.</span><span>        38.7 Colorado         -</span><span style='color: #BB0000;'>106.</span><span>        38.7      0  
#&gt; </span><span style='color: #555555;'> 9</span><span> Connectic…       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 Connecticut       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6      0  
#&gt; </span><span style='color: #555555;'>10</span><span> Connectic…       -</span><span style='color: #BB0000;'>72.4</span><span>       41.6 Massachuse…       -</span><span style='color: #BB0000;'>71.6</span><span>       42.4     66.7
#&gt; </span><span style='color: #555555;'># … with 114 more rows</span><span></div><div class='input'>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Robinson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


